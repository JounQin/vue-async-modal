/*!
 * vue-async-modal Flexible modal component for Vue with ability of asynchronous lazy loading
 * Version 1.0.0
 * Copyright (C) 2017 JounQin <admin@1stg.me>
 * Released under the MIT license
 *
 * Github: https://github.com/JounQin/vue-async-modal
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define("vue-async-modal",["exports","vue"],t):t(e.VueAsyncModal={},e.Vue)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var r=function(e){return new RegExp("(^|\\s+)"+e.toString().trim()+"(\\s+|$)","g")},a=function(t,e){var o,n=e.split(" ");1<n.length?n.forEach(function(e){return a(t,e)}):(o=t,r(e).test(o.className)||(t.className=(t.className+" "+e).trim()))},d={show:!0,backdrop:!0,destroy:!1},l="this modal item is not a Vue component, you should use `transition` component and emit `after-leave` event",o={render:function(){var a=this,e=a.$createElement,i=a._self._c||e;return a.modals.length?i("div",[a.currModal&&a.currModal.options.backdrop?i("div",{staticClass:"modal-backdrop"}):a._e(),a._l(a.modals,function(e){var o=e.id,t=e.component,n=e.props,r=e.options;return i(t,a._b({directives:[{name:"show",rawName:"v-show",value:r.show,expression:"options.show"}],key:o,ref:"modal",refInFor:!0,tag:"component",nativeOn:{click:function(e){return t=e,a.handleBackdrop(t,o,r.backdrop);var t}}},"component",n,!1))})],2):a._e()},staticRenderFns:[],data:function(){return{modals:[],currModal:null}},computed:{currModalId:function(){return this.currModal&&this.currModal.id}},watch:{currModal:function(e){return(e?a:function(e,t){e.className=e.className.replace(r(t)," ").trim()})(document.body,"modal-open")}},beforeCreate:function(){Object.defineProperty(t.prototype,"$modal",{value:this,writable:!1})},methods:{close:function(t,o){var e,n=this;if(!(t=t||this.currModalId)||!(e=this.getModal(t)))return Promise.resolve();var r=e.options;r.show=!1;var a=this.getModalItem(t);if(!a)return Promise.reject(new TypeError(l));var i=function(e){r.destroy||o?n.removeModal(t):n.resetCurrModal(t),e()};return new Promise(function(e){return"none"===getComputedStyle(a.$el).display?i(e):a.$once("after-leave",function(){return i(e)})})},closeAll:function(t,e){var o=this;void 0===t&&(t=!0);var n=Promise.resolve();return t&&e?this.modals=[]:this.modals.forEach(function(e){n=n.then(function(){return o.close(e.id,t)})}),n},open:function(t){var e,o=this;return t.id=t.id||Date.now(),e=t.component,"[object Promise]"===Object.prototype.toString.call(e)||e instanceof Promise?t.component.then(function(e){return o.resolve(Object.assign(t,{component:e.default||e}))}):this.resolve(t)},resolve:function(n){var r=this,a=n.id,e=n.component,t=n.props,o=n.options,i=this.getModal(a);if(i)e&&(i.component=e),n=i;else if(!e)return Promise.reject(new ReferenceError("no component passed on initialization"));n.props=Object.assign({},t);var s=Object.assign({},d,o);return s.show?(this.currModalId===a?Promise.resolve():this.close()).then(function(){return n.options=s,i||r.modals.push(n),r.currModal=n,new Promise(function(t,o){return r.$nextTick(function(){var e=r.getModalItem(a);e?e.$once("after-enter",function(){return t(n)}):o(new TypeError(l))})})}):(n.options=s,Promise.resolve())},getModal:function(t){return this.modals.find(function(e){return e.id===t})},getModalIndex:function(t){return this.modals.findIndex(function(e){return e.id===t})},getModalRef:function(e){return this.$refs.modal[this.getModalIndex(e)]},getModalItem:function(e){var t=this.getModalRef(e);return t&&t.$children[0]},resetCurrModal:function(e){e===this.currModalId&&(this.currModal=null)},removeModal:function(e){var t=this.getModalIndex(e);t+1&&this.modals.splice(t,1),this.resetCurrModal(e)},handleBackdrop:function(e,t,o){e.target===e.currentTarget&&"static"!==o&&this.close(t)}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("transition",{attrs:{name:t.transition},on:{"after-enter":function(e){t.$emit("after-enter")},"after-leave":function(e){t.$emit("after-leave")}}},[o("div",{staticClass:"modal",attrs:{id:t.id,tabindex:"-1",role:"dialog"}},[o("div",{staticClass:"modal-dialog"},[o("div",{staticClass:"modal-content"},[t.$slots.header?o("div",{staticClass:"modal-header"},[t._t("header")],2):t.header?o("div",{staticClass:"modal-header"},[o("button",{staticClass:"close",attrs:{type:"button"},on:{click:t.closeModal}},[t._v("×")]),t.header?o("h4",{staticClass:"modal-title",domProps:{innerHTML:t._s(t.header)}}):t._e()]):t._e(),t.$slots.body?t._t("body"):o("div",{staticClass:"modal-body"},[t._t("default")],2),t.$slots.footer?o("div",{staticClass:"modal-footer"},[t._t("footer")],2):t.footer?o("div",{staticClass:"modal-footer"},[o("div",{staticClass:"btn btn-default",on:{click:t.closeModal}},[t._v(t._s(t.cancelText||"取消"))]),o("div",{staticClass:"btn btn-primary",attrs:{disabled:t.disabled},on:{click:t.confirmModal}},[t._v(t._s(t.confirmText||"确定"))])]):t._e()],2)])])])},staticRenderFns:[],props:{id:[Number,String],header:String,footer:Boolean,disabled:Boolean,confirmText:String,cancelText:String,transition:{type:String,default:"fade"}},methods:{closeModal:function(){this.$modal.close()},confirmModal:function(){this.disabled||this.$emit("confirm")}}};e.Modal=o,e.ModalItem=n,Object.defineProperty(e,"__esModule",{value:!0})});
