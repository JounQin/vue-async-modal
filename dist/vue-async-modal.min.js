/*!
 * vue-async-modal Flexible modal component for Vue with ability of asynchronous lazy loading
 * Version 0.0.1
 * Copyright (C) 2017 JounQin <admin@1stg.me>
 * Released under the MIT license
 *
 * Github: https://github.com/JounQin/vue-async-modal
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define("vue-async-modal",["exports","vue"],t):t(e.VueAsyncModal=e.VueAsyncModal||{},e.Vue)}(this,function(e,t){"use strict";t=t&&"default"in t?t.default:t;var o=function(e){return"[object Promise]"===Object.prototype.toString.call(e)||e instanceof Promise},n={show:!0,backdrop:!0,destroy:!1},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.modals.length?o("div",[e.currModal&&e.currModal.options.backdrop?o("div",{staticClass:"modal-backdrop"}):e._e(),e._l(e.modals,function(t){var n=t.id,r=t.component,s=t.props,i=t.options;return o(r,e._b({directives:[{name:"show",rawName:"v-show",value:i.show,expression:"options.show"}],key:n,ref:"modal",refInFor:!0,tag:"component"},"component",s))})],2):e._e()},staticRenderFns:[],beforeCreate:function(){Object.defineProperty(t.prototype,"$modal",{value:this,writable:!1})},data:function(){return{modals:[],currModal:null}},computed:{currModalId:function(){return this.currModal&&this.currModal.id}},methods:{resetCurrModal:function(e){e===this.currModalId&&(this.currModal=null)},removeModal:function(e){var t=this.getModalIndex(e);t+1&&this.modals.splice(t,1),this.resetCurrModal(e)},close:function(e,t){var o=this;e=e||this.currModalId;var n=Promise.resolve();if(!e)return n;var r=this.getModal(e);if(!r)return n;var s=r.options;s.show=!1;var i=this.getModalRef(e).$children[0];return new Promise(function(n){return i.$once("after-leave",function(){s.destroy||t?o.removeModal(e):o.resetCurrModal(e),n()})})},open:function(e){var t=this;return e.id=e.id||Date.now(),o(e.component)?e.component.then(function(o){return t.resolve(Object.assign(e,{component:o}))}):this.resolve(e)},getModal:function(e){return this.modals.find(function(t){return t.id===e})},getModalIndex:function(e){return this.modals.findIndex(function(t){return t.id===e})},getModalRef:function(e){return this.$refs.modal[this.getModalIndex(e)]},resolve:function(e){var t=this,o=e.id,r=e.component,s=e.props,i=e.options,a=this.getModal(o);if(a)Object.assign(a.props,s),Object.assign(a.options,n,i),r&&(a.component=r),e=a;else{if(!r)return Promise.reject(new ReferenceError("no component passed on initialization"));e.options=Object.assign({},n,i),e.props=Object.assign({},s),this.modals.push(e)}var d=this.currModalId,c=Promise.resolve();return e.options.show?(d===o||(c=c.then(function(){return t.close()})),c.then(function(){t.currModal=e}),new Promise(function(n){return t.$nextTick(function(){t.getModalRef(o).$children[0].$once("after-enter",function(){return n(c.then(function(){return e}))})})})):c}}},s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("transition",{attrs:{name:"fade"},on:{"after-enter":function(t){e.$emit("after-enter")},"after-leave":function(t){e.$emit("after-leave")}}},[o("div",{staticClass:"modal"},[o("div",{staticClass:"modal-dialog"},[o("div",{staticClass:"modal-content"},[o("div",{staticClass:"modal-header"},[o("button",{staticClass:"close",attrs:{type:"button"},on:{click:e.closeModal}},[o("span",[e._v("Ã—")])])]),o("div",{staticClass:"modal-body"}),o("div",{staticClass:"modal-footer"})])])])])},staticRenderFns:[],methods:{closeModal:function(){this.$modal.close()}}};e.Modal=r,e.ModalItem=s,Object.defineProperty(e,"__esModule",{value:!0})});
