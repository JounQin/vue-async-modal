/*!
 * vue-async-modal Flexible modal component for Vue with ability of asynchronous lazy loading
 * Version 1.0.0-beta2
 * Copyright (C) 2017 JounQin <admin@1stg.me>
 * Released under the MIT license
 *
 * Github: https://github.com/JounQin/vue-async-modal
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define("vue-async-modal",["exports","vue"],t):t(e.VueAsyncModal={},e.Vue)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var o=function(e){return new RegExp("(^|\\s+)"+e.toString().trim()+"(\\s+|$)","g")},n=function(e,t){return o(t).test(e.className)},r=function(e,t){var o=t.split(" ");o.length>1?o.forEach(function(t){return r(e,t)}):n(e,t)||(e.className=(e.className+" "+t).trim())},i=function(e,t){e.className=e.className.replace(o(t)," ").trim()},a=function(e){return"[object Promise]"===Object.prototype.toString.call(e)||e instanceof Promise},s={show:!0,backdrop:!0,destroy:!1},d="this modal item is not a Vue component, you should use `transition` component and emit `after-leave` event",l={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.modals.length?o("div",[e.currModal&&e.currModal.options.backdrop?o("div",{staticClass:"modal-backdrop"}):e._e(),e._l(e.modals,function(t){var n=t.id,r=t.component,i=t.props,a=t.options;return o(r,e._b({directives:[{name:"show",rawName:"v-show",value:a.show,expression:"options.show"}],key:n,ref:"modal",refInFor:!0,tag:"component",nativeOn:{click:function(t){!function(t){e.handleBackdrop(t,n,a.backdrop)}(t)}}},"component",i,!1))})],2):e._e()},staticRenderFns:[],beforeCreate:function(){Object.defineProperty(t.prototype,"$modal",{value:this,writable:!1})},data:function(){return{modals:[],currModal:null}},computed:{currModalId:function(){return this.currModal&&this.currModal.id}},watch:{currModal:function(e){return(e?r:i)(document.body,"modal-open")}},methods:{close:function(e,t){var o,n=this;if(!(e=e||this.currModalId)||!(o=this.getModal(e)))return Promise.resolve();var r=o.options;r.show=!1;var i=this.getModalItem(e);if(!i)return Promise.reject(new TypeError(d));var a=function(o){r.destroy||t?n.removeModal(e):n.resetCurrModal(e),o()};return new Promise(function(e){return"none"===getComputedStyle(i.$el).display?a(e):i.$once("after-leave",function(){return a(e)})})},closeAll:function(e,t){var o=this;void 0===e&&(e=!0);var n=Promise.resolve();return e&&t?this.modals=[]:this.modals.forEach(function(t){n=n.then(function(){return o.close(t.id,e)})}),n},open:function(e){var t=this;return e.id=e.id||Date.now(),a(e.component)?e.component.then(function(o){return t.resolve(Object.assign(e,{component:o}))}):this.resolve(e)},resolve:function(e){var t=this,o=e.id,n=e.component,r=e.props,i=e.options,a=this.getModal(o);if(a)n&&(a.component=n),e=a;else if(!n)return Promise.reject(new ReferenceError("no component passed on initialization"));e.props=Object.assign({},r);var l=Object.assign({},s,i);return l.show?(this.currModalId===o?Promise.resolve():this.close()).then(function(){return e.options=l,a||t.modals.push(e),t.currModal=e,new Promise(function(n,r){return t.$nextTick(function(){var i=t.getModalItem(o);i?i.$once("after-enter",function(){return n(e)}):r(new TypeError(d))})})}):(e.options=l,Promise.resolve())},getModal:function(e){return this.modals.find(function(t){return t.id===e})},getModalIndex:function(e){return this.modals.findIndex(function(t){return t.id===e})},getModalRef:function(e){return this.$refs.modal[this.getModalIndex(e)]},getModalItem:function(e){var t=this.getModalRef(e);return t&&t.$children[0]},resetCurrModal:function(e){e===this.currModalId&&(this.currModal=null)},removeModal:function(e){var t=this.getModalIndex(e);t+1&&this.modals.splice(t,1),this.resetCurrModal(e)},handleBackdrop:function(e,t,o){e.target===e.currentTarget&&"static"!==o&&this.close(t)}}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("transition",{attrs:{name:e.transition},on:{"after-enter":function(t){e.$emit("after-enter")},"after-leave":function(t){e.$emit("after-leave")}}},[o("div",{staticClass:"modal",attrs:{id:e.id,tabindex:"-1",role:"dialog"}},[o("div",{staticClass:"modal-dialog"},[o("div",{staticClass:"modal-content"},[e.$slots.header?o("div",{staticClass:"modal-header"},[e._t("header")],2):e.header?o("div",{staticClass:"modal-header"},[o("button",{staticClass:"close",attrs:{type:"button"},on:{click:e.closeModal}},[e._v("×")]),e.header?o("h4",{staticClass:"modal-title",domProps:{innerHTML:e._s(e.header)}}):e._e()]):e._e(),e.$slots.body?e._t("body"):o("div",{staticClass:"modal-body"},[e._t("default")],2),e.$slots.footer?o("div",{staticClass:"modal-footer"},[e._t("footer")],2):e.footer?o("div",{staticClass:"modal-footer"},[o("div",{staticClass:"btn btn-default",on:{click:e.closeModal}},[e._v(e._s(e.cancelText||"取消"))]),o("div",{staticClass:"btn btn-primary",attrs:{disabled:e.disabled},on:{click:e.confirmModal}},[e._v(e._s(e.confirmText||"确定"))])]):e._e()],2)])])])},staticRenderFns:[],props:{id:[Number,String],header:String,footer:Boolean,disabled:Boolean,confirmText:String,cancelText:String,transition:{type:String,default:"fade"}},methods:{closeModal:function(){this.$modal.close()},confirmModal:function(){this.disabled||this.$emit("confirm")}}};e.Modal=l,e.ModalItem=c,Object.defineProperty(e,"__esModule",{value:!0})});
